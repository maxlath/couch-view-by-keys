#!/usr/bin/env node
const program = require('commander')

program
.option('-d, --debug', 'Debug')
.parse(process.argv)

const { debug } = program

var [ url, ...keys ] = program.args

const viewUrlPattern = /(https?):\/\/([^@]+)@(\w+):(\d+)\/([\w-_]+)\/_design\/([\w-_]+)\/_view\/([\w-_]+)/

// port, hostname, user, pass, auth, ssl, debug
const [ match, protocol, auth, hostname, port, dbName, designDocName, viewName ] = url.match(viewUrlPattern)
const ssl = protocol === 'https'

const config = { hostname, port, ssl, auth, debug }
const db = require('blue-cot')(config)(dbName, designDocName)

keys = keys.map(JSON.parse.bind(JSON))

db.viewByKeys(viewName, keys)
.then(JSON.stringify.bind(JSON))
.then(console.log)
.catch(console.error)
